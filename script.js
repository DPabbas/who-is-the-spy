// ฺฏุฑูุชู ุงูููุชโูุง
const setupScreen = document.getElementById("setup");
const revealScreen = document.getElementById("reveal");
const timerScreen = document.getElementById("timerScreen");

const totalInput = document.getElementById("totalPlayers");
const spyInput = document.getElementById("spyCount");

const roleBox = document.getElementById("roleBox");
const playerLabel = document.getElementById("playerLabel");
const timerText = document.getElementById("timer");

const startBtn = document.getElementById("startBtn");
const showBtn = document.getElementById("showBtn");
const hideNextBtn = document.getElementById("hideNextBtn");
const resetBtn = document.getElementById("resetBtn");
const go = document.getElementById("go");

const words = [
  "ฺฏุฑุจู","ุณฺฏ","ุงุณุจ","ูพุฑูุฏู","ูพููฺฏ","ุฎุฑฺฏูุด","ุดุฑ","ูู","ูุงุฑ","ฺฉูุณู","ูุงู","ุฎูฺฉ","ฺฏุงู","ฺฏูุณููุฏ","ุงุฑุฏฺฉ",
  "ูุงุดู","ุฏูฺุฑุฎู","ููุชูุฑ","ฺฉูุด","ฺฉูุงู","ฺฉุช","ุชโุดุฑุช","ูุจุงุณ","ุตูุฏู","ูุฒ","ฺฉุงุบุฐ","ุฎูุฏฺฉุงุฑ","ูุฏุงุฏ","ฺุฑุงุบ","ุชููุฒูู",
  "ูุฏุฑุณู","ุฎุงูู","ฺฉุชุงุจุฎุงูู","ูพุงุฑฺฉ","ููุฒู","ุฑุณุชูุฑุงู","ูุชู","ุณููุง","ุชุฆุงุชุฑ","ุจุงุฒุงุฑ","ูุฑูุฏฺฏุงู","ุงุณุชฺฏุงู","ูพู","ุฌุงุฏู","ุชููู",
  "ูุงู","ูพูุฑ","ุดุฑ","ูุงุณุช","ุนุณู","ฺฉุฑู","ุดฺฉูุงุช","ฺฉฺฉ","ุจุณุชู","ูพุงุณุชุง","ูพุชุฒุง","ููุจุฑฺฏุฑ","ุณููพ","ุณุงูุงุฏ","ุฎูุฑุดุช",
  "ฺฺฉุด","ูพฺโฺฏูุดุช","ุงุฑู","ุงูุจุฑุฏุณุช","ูุชุฑ","ุฎุทโฺฉุด","ูฺ","ูุฎ","ูพฺ","ฺฉุงุชุฑ","ุณูฺฏ","ุฏุฑู","ุณุงุทูุฑ","ฺุงูู","ุขฺุงุฑ",
  "ุฏุฑุง","ุฑูุฏ","ฺฉูู","ุชูพู","ุจุงุจุงู","ุฌูฺฏู","ฺฏู","ุฏุฑุฎุช","ฺูู","ุณุงุญู","ุฌุฒุฑู","ุงุจุฑ","ุจุงุฑุงู","ุจุฑู","ุจุงุฏ",
  "ููุชุจุงู","ุจุณฺฉุชุจุงู","ูุงูุจุงู","ุชูุณ","ฺฏูู","ุชูุณโุฑูโูุฒ","ุดูุง","ุฏูุฏู","ุฏูฺุฑุฎูโุณูุงุฑ","ุจูฺฉุณ","ฺููุงุณุชฺฉ","ููุฏุจุงู","ุงุณฺฉุช","ุงุณฺฉ","ุงุณููุจุฑุฏ",
  "ุงุชูุจูุณ","ุชุงฺฉุณ","ูุทุงุฑ","ููุงูพูุง","ุจุงูฺฏุฑุฏ","ฺฉุดุช","ูุงู","ููุชูุฑ","ุฏูฺุฑุฎู","ูุงุดูโุขูุงุช","ฺฉุงููู","ุฏูฺุฑุฎูโุงูฺฉุชุฑฺฉ","ุงุณฺฉูุชุฑ","ูุชุฑู","ููโุจูุณ",
  "ฺฏูุด","ุชููุฒูู","ุฑุงุฏู","ฺฉุงููพูุชุฑ","ููพโุชุงูพ","ุชุจูุช","ุฏูุฑุจู","ูุฏุณุช","ุณุงุนุชโููุดููุฏ","ูพุฑุฒ","ฺุฑุงุบโููู","ุฏูุฑุจูโูุฏุงุฑุจุณุชู","ููุฏู","ุฑูุชุฑ","ูพุฑูุชุฑ",
  "ุตูุฏู","ูุฒ","ฺฉุงูุงูพู","ุชุฎุช","ฺฉูุฏ","ููุณู","ูุฒูุงูุงุฑุฎูุฑ","ูุฒุชุญุฑุฑ","ุตูุฏูโุชุญุฑุฑ","ูุฒุชููุฒูู","ฺฉุชุงุจุฎุงูู","ูุฑุด","ููฺฉุช","ูพุงู","ูุฒูููู",
  "ูุงูุชุงุจู","ูุงุจููู","ฺุงูู","ฺฉุงุณู","ุจุดูุงุจ","ููุงู","ุธุฑู","ุฎฺุงู","ูุฑ","ูุงฺฉุฑููู","ุชูุณุชุฑ","ฺฉุชุฑ","ููููโุณุงุฒ","ุขุณุงุจ","ุจุดูุงุจโูพุดโุฏุณุช",
  "ฺฏุชุงุฑ","ูพุงูู","ูููู","ุฏู","ุชูุจฺฉ","ุณุงุฒ","ุณุงุฒฺฉูฺฺฉ","ูููุช","ุชูุจูุฑ","ุณูุชูุฑ","ฺฉูุงูฺู","ู","ุฏุฑุงูุฒ","ุณุงฺฉุณููู","ุงุฑฺฏ",
  "ุฏูฺุฑุฎู","ููุชูุฑ","ุงุณฺฉูุชุฑ","ุงุณฺฉุช","ูุงู","ูุงูโุจุงุฏุจุงู","ูุงูโูพุงุฑู","ูุงูโุชูุฑุญ","ูุงูโฺูุจ","ูุงูโููุฒ","ูุงูโุจุงุฏ","ูุงูโูุณุงูุฑุช","ุงุณฺฉูุชุฑุงูฺฉุชุฑฺฉ","ุณฺฉูุช","ูุงุดูโุขูุงุช",
  "ุฏูุชุฑ","ฺฉุงุบุฐ","ุฎูุฏฺฉุงุฑ","ูุฏุงุฏ","ูพุงฺฉโฺฉู","ูุงฺฺฉ","ูููโูู","ุชุฎุชูโุณุงู","ุชุฎุชูโูุงุชโุจูุฑุฏ","ฺฉูุงุณูุฑ","ูุฏุงุฏุฑูฺฏ","ุฎุทโฺฉุด","ูพุฑฺฏุงุฑ","ฺฏุฑู","ฺฉุงุชุฑ",
  "ุฑฺูุจ","ุฑูู","ูุงฺฉ","ูพูฺฉฺฉ","ฺฉุฑู","ูุงุณฺฉ","ุงุฏฺฉูู","ุนุทุฑ","ูุงฺฉโูุงุฎู","ูพูุฏุฑ","ุณุงู","ุฎุทโฺุดู","ุตุงุจูู","ุดุงููพู","ฺฉุฑูโุฏุณุช",
  "ฺฉูุดโูุฑุฒุด","ุชโุดุฑุชโูุฑุฒุด","ุดููุงุฑฺฉ","ฺฉูุงูโูุฑุฒุด","ุณูุดุฑุช","ูุจุงุณโูุฑุฒุด","ุฌูุฑุงุจโูุฑุฒุด",
  "ุฏุฑฺู","ูพูุฌุฑู","ุณูู","ุฏูุงุฑ","ฺฉู","ุจุงูฺฉู","ุฑุงูุฑู","ุฑุงูโูพูู","ูพูู","ุฑุงูโุขูู","ุงุณุชฺฏุงู","ุณฺฉู","ูุฏุงู","ุฎุงุจุงู","ฺฉูฺู",
  "ฺุฑุงุบโุฑุงูููุง","ุชุงุจูู","ููุงุด","ูพูุณุชุฑ","ูุฌุณูู","ุชุงุจูููุฑุด","ฺฉุชุงุจฺู","ุฏูุชุฑฺู","ููุงูู","ููุงููโููุณ","ุขุฏุฑุณ","ฺฉุงุฑุช","ูพูุงฺฉ","ูุฌูู","ุฑูุฒูุงูู",
  "ุนูฺฉ","ููุฒ","ุฏูุฑุจู","ฺฉุงุฑุชโูพุณุชุงู","ูพุงฺฉุช","ูพุงฺฉโฺฉู","ูุดุงูฺฏุฑ","ูุฏุงุฏุดูุน","ูุงฺฺฉโุฑูุงูโููุณ","ุฎูุฏููุณ","ููู","ฺฉูุงุณูุฑ","ุฏูุชุฑ","ฺฉุชุงุจฺู","ุฑุงูููุง",
  "ุชุฎุชู","ุชุฎุชูโุณุงู","ุชุฎุชูโูุงุชโุจูุฑุฏ","ูุฑุฏุจุงู","ุณุทู","ุณุทูโุฒุจุงูู","ฺฉุณู","ูุฎ","ููุงุฑ","ฺุณุจ","ฺฏุฑู","ููุงุฑฺุณุจ","ฺุฑุฎ","ฺุฑุฎโุฏุณุช","ฺุฑุฎโุญูู",
  "ุชุฑุงฺฉุช","ูพูุณุชุฑ","ุจุฑูุดูุฑ","ุจูุจูุฑุฏ","ูููโูู","ุฑูฺฏ","ุฑูฺฏโูพุงุด","ุฑูฺฏโุขูุฒ","ูพุงูุช","ูุฑฺู","ูุฏุงุฏุฑูฺฏ","ฺฏฺ","ููุฑ","ุชูุจุฑ","ูพุงฺฉุชโูุงูู",
  "ููุณู","ฺฉูุฏ","ฺฉุงุจูุช","ุฏุฑฺู","ูพูฺฉู","ฺฉููุฑ","ุจุฎุงุฑ","ุดููุงฺ","ุฑุงุฏุงุชูุฑ","ููุงุฒูโุฎุงูฺฏ","ุฎฺุงูโูุฑุฒุฑ","ูุงุดูโูุจุงุณโุดู","ุงุชู","ุขุจโฺฏุฑูฺฉู","ฺุงโุณุงุฒ",
  "ููููโุณุงุฒ","ุขุณุงุจ","ูุงฺฉุฑููู","ูุฑ","ุชูุณุชุฑ",

]
let roles = [];
let currentPlayer = 0;
let secretWord = "";
let timer = null;

// ๐ ุณุงุฎุช ุตุฏุง ุจูู ุจุง Web Audio
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeep() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = "sine";
  osc.frequency.value = 800; // ูุฑฺฉุงูุณ ุตุฏุง
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
  osc.stop(audioCtx.currentTime + 0.2);
}

// ุดุฑูุน ุจุงุฒ
startBtn.onclick = function () {
  const totalPlayers = Number(totalInput.value);
  const spyCount = Number(spyInput.value);

  if (totalPlayers < 3 || spyCount >= totalPlayers) {
    alert("ุชุนุฏุงุฏ ุจุงุฒฺฉู ุง ุฌุงุณูุณ ุงุดุชุจุงู ุงุณุช");
    return;
  }

  // ุงูุชุฎุงุจ ฺฉููู
  secretWord = words[Math.floor(Math.random() * words.length)];

  // ุณุงุฎุช ููุดโูุง
  roles = [];
  for (let i = 0; i < spyCount; i++) roles.push("spy");
  for (let i = 0; i < totalPlayers - spyCount; i++) roles.push("normal");

  // ุฑูุฏู ฺฉุฑุฏู
  roles.sort(() => Math.random() - 0.5);

  currentPlayer = 0;

  setupScreen.classList.remove("active");
  revealScreen.classList.add("active");

  preparePlayer();
};

// ุขูุงุฏูโุณุงุฒ ุตูุญู ุจุฑุง ูุฑ ููุฑ
function preparePlayer() {
  playerLabel.textContent = "ููุฑ " + (currentPlayer + 1);
  roleBox.textContent = " ";
  showBtn.style.display = "block";
  hideNextBtn.style.display = "none";
}

// ุฏฺฉูู ููุงุด ููุด
showBtn.onclick = function () {
  if (roles[currentPlayer] === "spy") {
    roleBox.textContent = "ุง ฺฉูฺฉ ุงู ุฏุณุช ุฌุงุณูุณ ";
  } else {
    roleBox.textContent =  secretWord;
  }

  showBtn.style.display = "none";
  hideNextBtn.style.display = "block";
};

// ุฏฺฉูู ูุฎู ฺฉู ู ููุฑ ุจุนุฏ
hideNextBtn.onclick = function () {
  currentPlayer++;

  if (currentPlayer < roles.length) {
    preparePlayer();
  } else {
    startTimerScreen();
  }
};

// ุฑูุชู ุจู ุชุงูุฑ
function startTimerScreen() {
  revealScreen.classList.remove("active");
  timerScreen.classList.add("active");
  startTimer(120);
}

// ุชุงูุฑ ุจุง ุตุฏุง
function startTimer(seconds) {
  let remaining = seconds;
  updateTimer(remaining);

  timer = setInterval(function () {
    remaining--;
    updateTimer(remaining);

    // ูุฑ ุซุงูู ุตุฏุง ุจุฏู
    playBeep();

    if (remaining <= 0) {
      clearInterval(timer);
      timerText.textContent = " ุฌุงุณูุณ ูุฑฺฉ ุจูุฏ ุจุฑุฏ";
      playBeep(); playBeep(); playBeep(); // ุจูู ูพุงุงู
      go.textContent = " "

    }
  }, 1000);
}

function updateTimer(sec) {
  const m = String(Math.floor(sec / 60)).padStart(2, "0");
  const s = String(sec % 60).padStart(2, "0");
  timerText.textContent = m + ":" + s;
}

// ุฑุณุช
resetBtn.onclick = function () {
  location.reload();
};


// sw.js
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/sw.js')
    .then(()=> console.log('Service Worker ุซุจุช ุดุฏ'))
    .catch(err=> console.log('Service Worker ุซุจุช ูุดุฏ', err));
}

